# 📄 追加機能要件定義書

## 概要
既存の勉強タイマーアプリに、**タスク管理機能** と **ローマ皇帝AIアドバイザー機能** を追加する。

---

## 1. 追加機能概要

### 1.1 デイリータスク管理機能
- **初回アクセス時のタスク入力**: その日初めてサイトにアクセスした際に、その日のタスクを入力できる
- **現在のタスク選択・表示**: 入力したタスクから1つを選んで「現在取り組み中」として表示
- **タスク進捗管理**: 完了/未完了の状態管理

### 1.2 ローマ皇帝AIアドバイザー機能
- **OpenAI API統合**: GPTモデルを使用してローマ皇帝の人格でアドバイス
- **タスクベース助言**: 現在のタスクに基づいた励ましやアドバイス
- **進捗リマインダー**: 未完了タスクについての注意喚起（バリエーション豊富）

---

## 2. 機能詳細仕様

### 2.1 タスク管理システム

#### データ構造
```javascript
{
  "dailyTasks": {
    "2025-01-16": {
      "tasks": [
        {
          "id": "task-uuid-1",
          "text": "数学の宿題を終わらせる",
          "completed": false,
          "createdAt": "2025-01-16T09:00:00Z"
        },
        {
          "id": "task-uuid-2", 
          "text": "英単語を50個覚える",
          "completed": true,
          "createdAt": "2025-01-16T09:00:00Z"
        }
      ],
      "currentTaskId": "task-uuid-1"
    }
  }
}
```

#### UI要素
1. **タスク入力モーダル**
   - その日初回アクセス時に自動表示
   - 複数タスクを一度に入力可能（最大10個）
   - 「今日のタスクを設定」ボタン

2. **現在のタスク表示エリア**
   - タイマー画面上部に常時表示
   - ドロップダウンで他のタスクに切り替え可能
   - 完了チェックボックス付き

3. **タスク進捗インジケーター**
   - 「3/5 タスク完了」のような表示
   - プログレスバー

### 2.2 ローマ皇帝AIアドバイザー

#### API設定
```javascript
{
  "openai": {
    "apiKey": "環境変数から取得",
    "model": "gpt-4o-mini",
    "maxTokens": 150,
    "temperature": 0.8
  }
}
```

#### プロンプト設計
```
あなたは{emperor_name}です。以下の状況でユーザーにアドバイスをしてください：

現在のタスク: {current_task}
今日のタスク一覧: {all_tasks}
完了済みタスク: {completed_tasks}
残りタスク: {remaining_tasks}

以下の点に注意してアドバイスしてください：
1. {emperor_name}の性格や名言を反映した口調で
2. 現在のタスクへの励ましやアドバイス
3. 残りタスクがある場合は、それについても言及（「まだ〜が残っているぞ」以外のバリエーション豊富に）
4. 日本語で100文字以内

例：
- マルクス・アウレリウス：「今この瞬間に集中せよ。{current_task}は君の成長の糧となる。」
- アウグストゥス：「ゆっくり急げ。{current_task}を着実に進めることが、残りの{remaining_count}つのタスクへの道を開く。」
```

#### 助言トリガー
1. **タスク切り替え時**: 新しいタスクを選択した際
2. **ポモドーロ休憩開始時**: 進捗を褒める
3. **勉強開始から30分毎**: モチベーション維持
4. **手動リクエスト**: 「助言を求める」ボタン

---

## 3. 技術実装仕様

### 3.1 必要な追加ファイル
- `/api-config.js`: OpenAI API設定管理
- `/task-manager.js`: タスク管理ロジック
- `/emperor-ai.js`: AI助言システム

### 3.2 環境変数
```bash
OPENAI_API_KEY=your-api-key-here
```

### 3.3 LocalStorage キー
- `dailyTasks`: タスクデータ
- `lastAccessDate`: 最終アクセス日（初回判定用）
- `aiAdviceHistory`: AI助言履歴（オプション）

---

## 4. セキュリティ考慮事項

1. **APIキー管理**
   - クライアントサイドにAPIキーを直接埋め込まない
   - プロキシサーバー経由またはサーバーレス関数を使用

2. **レート制限**
   - AI助言リクエストは1分間に3回まで
   - 1日あたり100回まで

---

## 5. UI/UXガイドライン

1. **タスク管理UI**
   - 既存のフラットUIデザインに統合
   - 目立ちすぎない配置
   - スムーズなアニメーション

2. **AI助言表示**
   - 皇帝の画像と吹き出し形式
   - フェードイン/アウトアニメーション
   - 非侵襲的な通知スタイル

---

## 6. テスト項目

1. **タスク管理**
   - T-A01: 初回アクセス時のモーダル表示
   - T-A02: タスク入力・保存・表示
   - T-A03: タスク切り替え・完了処理
   - T-A04: 日付変更時のリセット

2. **AI機能**
   - T-B01: API接続テスト
   - T-B02: 各皇帝の性格反映確認
   - T-B03: エラーハンドリング（API障害時）
   - T-B04: レート制限動作確認

---

## 7. 今後の拡張可能性

1. **統計機能**: タスク完了率の可視化
2. **皇帝選択**: お気に入り皇帝の設定
3. **実績システム**: タスク完了数に応じた称号
4. **共有機能**: 進捗のSNS共有

---

## 8. 実装優先順位

1. **Phase 1**: タスク管理基本機能（入力・表示・切り替え）
2. **Phase 2**: LocalStorage保存・日付管理
3. **Phase 3**: OpenAI API統合準備
4. **Phase 4**: ローマ皇帝AI助言システム
5. **Phase 5**: UI改善・アニメーション追加

---

この要件定義書に従って、既存のstudy-timerアプリに新機能を追加実装する。